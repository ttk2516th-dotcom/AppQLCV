<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tr·ª£ l√Ω Gi√°o vi√™n</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ===== BASE ===== */
.today { background:#dbeafe }
.other-month { color:#9ca3af }
.dot {
  width:6px;
  height:6px;
  border-radius:50%;
  display:inline-block;
  margin-right:2px;
}
.status {
  font-size:12px;
  padding:2px 6px;
  border-radius:6px;
  background:#e5e7eb;
}

/* ===== BOTTOM BAR WITH CURVE ===== */
.bottom-bar {
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:72px;
  background:#fff;
  border-top-left-radius:24px;
  border-top-right-radius:24px;
  box-shadow:0 -2px 10px rgba(0,0,0,.08);
  display:flex;
  justify-content:space-around;
  align-items:center;
  z-index:1000;
}
.bottom-bar::before {
  content:"";
  position:absolute;
  top:-28px;
  left:50%;
  transform:translateX(-50%);
  width:84px;
  height:56px;
  background:#fff;
  border-radius:0 0 42px 42px;
  box-shadow:0 -4px 10px rgba(0,0,0,.08);
}

/* ===== CENTER PLUS ===== */
.center-plus {
  position:fixed;
  bottom:36px;
  left:50%;
  transform:translateX(-50%);
  width:64px;
  height:64px;
  border-radius:50%;
  background:#2563eb;
  color:#fff;
  font-size:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1100;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}

/* ===== MODAL ===== */
.modal-bg {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
}
.modal {
  background:#fff;
  width:92%;
  max-width:540px;
  border-radius:16px;
  padding:16px;
  max-height:90vh;
  overflow:auto;
}
</style>
</head>

<body class="bg-gray-100 pb-24">

<div class="max-w-md mx-auto bg-white min-h-screen">
<header class="p-4 text-center font-bold text-xl border-b">
üìò Tr·ª£ l√Ω Gi√°o vi√™n
</header>

<main class="p-3">

<!-- ================= TAB MONTH ================= -->
<section id="tab-month">
  <div class="flex justify-between mb-2">
    <button onclick="changeMonth(-1)">‚óÄ</button>
    <h2 id="monthTitle" class="font-semibold"></h2>
    <button onclick="changeMonth(1)">‚ñ∂</button>
  </div>

  <div class="grid grid-cols-7 text-center text-xs font-semibold mb-1">
    <div>CN</div><div>T2</div><div>T3</div><div>T4</div>
    <div>T5</div><div>T6</div><div>T7</div>
  </div>

  <div id="monthGrid" class="grid grid-cols-7 gap-1"></div>
</section>

<!-- ================= TAB DAY ================= -->
<section id="tab-day" class="hidden">
  <h2 id="dayTitle" class="font-semibold mb-2"></h2>
  <div id="dayTasks" class="space-y-2 text-sm"></div>
</section>

</main>
</div>

<!-- CENTER PLUS -->
<button class="center-plus" onclick="openModal()">Ôºã</button>

<!-- BOTTOM BAR -->
<div class="bottom-bar">
  <button onclick="showTab('month')">üìÖ<br>Th√°ng</button>
  <button onclick="showTab('day')">‚è∞<br>Ng√†y</button>
  <div style="width:72px"></div>
  <button>üìä<br>B√°o c√°o</button>
  <button>‚öôÔ∏è<br>C√†i ƒë·∫∑t</button>
</div>

<!-- ================= MODAL ================= -->
<div id="modalBg" class="modal-bg">
<div class="modal">
<h3 class="font-semibold mb-3">‚ûï Th√™m c√¥ng vi·ªác</h3>

<!-- 1. T√äN -->
<input id="mTitle" class="w-full border p-2 rounded mb-2"
 placeholder="T√™n c√¥ng vi·ªác">

<!-- 2. VAI TR√í -->
<select id="mRole" class="w-full border p-2 rounded mb-2">
  <option value="GVDL">Gi√°o vi√™n d·∫°y l·ªõp</option>
  <option value="GVCN">Gi√°o vi√™n ch·ªß nhi·ªám</option>
  <option value="TTCM">T·ªï tr∆∞·ªüng chuy√™n m√¥n</option>
  <option value="DANG">ƒê·∫£ng vi√™n</option>
  <option value="DOAN">ƒêo√†n vi√™n</option>
  <option value="DOI">H·ªó tr·ª£ ƒê·ªôi</option>
  <option value="KHAC">Kh√°c</option>
</select>

<!-- 3. CHI TI·∫æT -->
<textarea id="mDetail" class="w-full border p-2 rounded mb-2"
 placeholder="Chi ti·∫øt c√¥ng vi·ªác"></textarea>

<!-- 4‚Äì7. TH·ªúI GIAN -->
<label class="text-xs">Ng√†y b·∫Øt ƒë·∫ßu</label>
<input id="mStartDate" type="date" class="w-full border p-2 rounded mb-2">

<label class="text-xs">Gi·ªù b·∫Øt ƒë·∫ßu</label>
<input id="mStartTime" type="time" class="w-full border p-2 rounded mb-2">

<label class="text-xs">Ng√†y k·∫øt th√∫c</label>
<input id="mEndDate" type="date" class="w-full border p-2 rounded mb-2">

<label class="text-xs">Gi·ªù k·∫øt th√∫c</label>
<input id="mEndTime" type="time" class="w-full border p-2 rounded mb-3">

<!-- 8. CH·∫æ ƒê·ªò -->
<div class="border p-2 rounded mb-2 text-sm">
<b>Ch·∫ø ƒë·ªô c√¥ng vi·ªác</b><br>
<label><input type="radio" name="mode" value="FIXED" checked> ƒê√∫ng h·∫°n</label><br>
<label><input type="radio" name="mode" value="FLEX"> Linh ƒë·ªông</label>
</div>

<!-- 9. L·∫∂P L·∫†I -->
<div class="border p-2 rounded mb-2 text-sm">
<b>L·∫∑p l·∫°i</b><br>
<label><input type="radio" name="repeat" value="NONE" checked> Kh√¥ng l·∫∑p</label><br>
<label><input type="radio" name="repeat" value="DAILY"> Theo gi·ªù m·ªói ng√†y</label><br>
<label><input type="radio" name="repeat" value="WEEKLY"> Theo ng√†y trong tu·∫ßn</label><br>
<label><input type="radio" name="repeat" value="MONTHLY"> Theo ng√†y trong th√°ng</label>
</div>

<!-- 10. TH√îNG B√ÅO -->
<div class="border p-2 rounded mb-3 text-sm">
<b>üîî Th√¥ng b√°o</b><br>
<label><input type="checkbox" id="n1d"> Tr∆∞·ªõc 1 ng√†y</label><br>
<label><input type="checkbox" id="n1h"> Tr∆∞·ªõc 1 gi·ªù</label><br>
<label><input type="checkbox" id="nStart"> Khi b·∫Øt ƒë·∫ßu</label><br>
<label><input type="checkbox" id="nHalf"> Khi tr√¥i qua 50%</label><br>
<label><input type="checkbox" id="nEnd1d"> Tr∆∞·ªõc khi k·∫øt th√∫c 1 ng√†y</label><br>
<label><input type="checkbox" id="nEnd1h"> Tr∆∞·ªõc khi k·∫øt th√∫c 1 gi·ªù</label><br>
<label><input type="checkbox" id="nEnd"> Khi ƒë√£ k·∫øt th√∫c</label>
</div>

<div class="flex justify-end gap-3">
<button onclick="closeModal()">Hu·ª∑</button>
<button class="bg-blue-600 text-white px-4 py-2 rounded"
 onclick="saveTask()">L∆∞u</button>
</div>
</div>
</div>

<script>
/* ================= DATE UTILS (NO TIMEZONE BUG) ================= */
const pad = n => String(n).padStart(2,'0');
const toYMD = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;

/* ================= STATE ================= */
let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
let viewDate = new Date();
let selectedDate = new Date();

/* ================= TAB ================= */
function showTab(t){
  document.getElementById('tab-month').classList.toggle('hidden', t !== 'month');
  document.getElementById('tab-day').classList.toggle('hidden', t !== 'day');
  if(t === 'day') renderDay();
}

/* ================= MONTH ================= */
function changeMonth(step){
  viewDate.setMonth(viewDate.getMonth() + step);
  renderMonth();
}

function renderMonth(){
  monthGrid.innerHTML = '';
  const y = viewDate.getFullYear();
  const m = viewDate.getMonth();
  monthTitle.innerText = `Th√°ng ${m+1}/${y}`;

  const first = new Date(y, m, 1).getDay();
  const start = new Date(y, m, 1 - first);

  for(let i=0;i<42;i++){
    const d = new Date(start);
    d.setDate(start.getDate() + i);
    const ymd = toYMD(d);

    const cell = document.createElement('div');
    cell.className = 'border rounded p-1 text-xs min-h-[60px]';
    if(d.getMonth() !== m) cell.classList.add('other-month');
    if(ymd === toYMD(new Date())) cell.classList.add('today');

    cell.innerHTML = `<div>${d.getDate()}</div>`;

    tasks
      .filter(t => t.startDate <= ymd && t.endDate >= ymd)
      .forEach(() => {
        cell.innerHTML += `<span class="dot bg-blue-600"></span>`;
      });

    cell.onclick = () => { selectedDate = d; showTab('day'); };
    monthGrid.appendChild(cell);
  }
}

/* ================= DAY ================= */
function renderDay(){
  dayTitle.innerText = selectedDate.toLocaleDateString('vi-VN');
  dayTasks.innerHTML = '';
  const ymd = toYMD(selectedDate);

  tasks
    .filter(t => t.startDate <= ymd && t.endDate >= ymd)
    .forEach(t => {
      dayTasks.innerHTML += `
        <div class="border p-2 rounded">
          <b>${t.title}</b><br>
          ${t.startDate} ${t.startTime} ‚Üí ${t.endDate} ${t.endTime}
        </div>`;
    });
}

/* ================= MODAL ================= */
function openModal(){
  modalBg.style.display = 'flex';
  const d = toYMD(selectedDate);
  mStartDate.value = d;
  mEndDate.value = d;
}

function closeModal(){
  modalBg.style.display = 'none';
}

function saveTask(){
  const mode = document.querySelector('input[name="mode"]:checked').value;
  const repeat = document.querySelector('input[name="repeat"]:checked').value;

  tasks.push({
    id: Date.now(),
    title: mTitle.value,
    role: mRole.value,
    detail: mDetail.value,
    startDate: mStartDate.value,
    endDate: mEndDate.value,
    startTime: mStartTime.value,
    endTime: mEndTime.value,
    mode,
    repeat,
    notify:{
      n1d:n1d.checked,
      n1h:n1h.checked,
      nStart:nStart.checked,
      nHalf:nHalf.checked,
      nEnd1d:nEnd1d.checked,
      nEnd1h:nEnd1h.checked,
      nEnd:nEnd.checked
    }
  });

  localStorage.setItem('tasks', JSON.stringify(tasks));
  closeModal();
  renderMonth();
  renderDay();
}

/* ================= INIT ================= */
renderMonth();
</script>

</body>
</html>
