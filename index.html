<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tr·ª£ l√Ω Gi√°o vi√™n</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ===== BASE ===== */
.today{background:#dbeafe}
.other-month{color:#9ca3af}
.dot{width:6px;height:6px;border-radius:50%;display:inline-block;margin-right:2px}
.status{font-size:12px;padding:2px 6px;border-radius:999px;color:#fff}

/* ===== BOTTOM BAR WITH CURVE ===== */
.bottom-bar{
  position:fixed;bottom:0;left:0;right:0;height:72px;background:#fff;
  border-top-left-radius:24px;border-top-right-radius:24px;
  box-shadow:0 -2px 10px rgba(0,0,0,.08);
  display:flex;justify-content:space-around;align-items:center;z-index:1000
}
.bottom-bar::before{
  content:"";position:absolute;top:-28px;left:50%;transform:translateX(-50%);
  width:84px;height:56px;background:#fff;border-radius:0 0 42px 42px;
  box-shadow:0 -4px 10px rgba(0,0,0,.08)
}

/* ===== CENTER PLUS (UI POLISH v1.3.3) ===== */
.center-plus{
  position:fixed;bottom:36px;left:50%;transform:translateX(-50%);
  width:66px;height:66px;border-radius:999px;
  background:linear-gradient(145deg,#3b82f6,#2563eb);
  color:#fff;font-size:36px;font-weight:600;
  display:flex;align-items:center;justify-content:center;
  z-index:1100;
  box-shadow:
    0 12px 28px rgba(37,99,235,.35),
    inset 0 1px 0 rgba(255,255,255,.35);
}
.center-plus:active{
  transform:translateX(-50%) scale(.96);
}

/* ===== MODAL ===== */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:2000}
.modal{background:#fff;width:92%;max-width:540px;border-radius:16px;padding:16px;max-height:90vh;overflow:auto}
</style>
</head>

<body class="bg-gray-100 pb-24">

<div class="max-w-md mx-auto bg-white min-h-screen">
<header class="p-4 text-center font-bold text-xl border-b">üìò Tr·ª£ l√Ω Gi√°o vi√™n</header>

<main class="p-3">

<!-- ================= TAB MONTH ================= -->
<section id="tab-month">
  <div class="flex justify-between mb-2">
    <button onclick="changeMonth(-1)">‚óÄ</button>
    <h2 id="monthTitle" class="font-semibold"></h2>
    <button onclick="changeMonth(1)">‚ñ∂</button>
  </div>

  <!-- WEEK HEADER (MONDAY FIRST) -->
  <div class="grid grid-cols-7 text-center text-xs font-semibold mb-1">
    <div>T2</div><div>T3</div><div>T4</div><div>T5</div>
    <div>T6</div><div>T7</div><div>CN</div>
  </div>

  <div id="monthGrid" class="grid grid-cols-7 gap-1"></div>
</section>

<!-- ================= TAB DAY ================= -->
<section id="tab-day" class="hidden">
  <h2 id="dayTitle" class="font-semibold mb-2"></h2>
  <div id="dayTasks" class="space-y-2 text-sm"></div>
</section>

</main>
</div>

<!-- CENTER PLUS -->
<button class="center-plus" onclick="openModal()">+</button>

<!-- BOTTOM BAR -->
<div class="bottom-bar">
  <button onclick="showTab('month')">üìÖ<br><span class="text-xs">L·ªãch th√°ng</span></button>
  <button onclick="showTab('day')">‚è∞<br><span class="text-xs">L·ªãch ng√†y</span></button>
  <div style="width:72px"></div>
  <button>üìä<br><span class="text-xs">B√°o c√°o</span></button>
  <button>‚öôÔ∏è<br><span class="text-xs">C√†i ƒë·∫∑t</span></button>
</div>

<!-- ================= MODAL ================= -->
<div id="modalBg" class="modal-bg">
<div class="modal">
<h3 id="modalTitle" class="font-semibold mb-3">‚ûï Th√™m c√¥ng vi·ªác</h3>

<input id="mTitle" class="w-full border p-2 rounded mb-2" placeholder="T√™n c√¥ng vi·ªác">

<select id="mRole" class="w-full border p-2 rounded mb-2">
  <option value="GVDL">Gi√°o vi√™n d·∫°y l·ªõp</option>
  <option value="GVCN">Gi√°o vi√™n ch·ªß nhi·ªám</option>
  <option value="TTCM">T·ªï tr∆∞·ªüng chuy√™n m√¥n</option>
  <option value="DANG">ƒê·∫£ng vi√™n</option>
  <option value="DOAN">ƒêo√†n vi√™n</option>
  <option value="DOI">H·ªó tr·ª£ ƒê·ªôi</option>
  <option value="KHAC">Kh√°c</option>
</select>

<textarea id="mDetail" class="w-full border p-2 rounded mb-2" placeholder="Chi ti·∫øt c√¥ng vi·ªác"></textarea>

<label class="text-xs">Ng√†y b·∫Øt ƒë·∫ßu</label>
<input id="mStartDate" type="date" class="w-full border p-2 rounded mb-2">

<label class="text-xs">Gi·ªù b·∫Øt ƒë·∫ßu</label>
<input id="mStartTime" type="time" class="w-full border p-2 rounded mb-2">

<label class="text-xs">Ng√†y k·∫øt th√∫c</label>
<input id="mEndDate" type="date" class="w-full border p-2 rounded mb-2">

<label class="text-xs">Gi·ªù k·∫øt th√∫c</label>
<input id="mEndTime" type="time" class="w-full border p-2 rounded mb-3">

<div class="border p-2 rounded mb-2 text-sm">
<b>Ch·∫ø ƒë·ªô c√¥ng vi·ªác</b><br>
<label><input type="radio" name="mode" value="FIXED" checked> ƒê√∫ng h·∫°n</label><br>
<label><input type="radio" name="mode" value="FLEX"> Linh ƒë·ªông</label>
</div>

<div class="border p-2 rounded mb-2 text-sm">
<b>L·∫∑p l·∫°i</b><br>
<label><input type="radio" name="repeat" value="NONE" checked> Kh√¥ng l·∫∑p</label><br>
<label><input type="radio" name="repeat" value="DAILY"> Theo gi·ªù m·ªói ng√†y</label><br>
<label><input type="radio" name="repeat" value="WEEKLY"> Theo ng√†y trong tu·∫ßn</label><br>
<label><input type="radio" name="repeat" value="MONTHLY"> Theo ng√†y trong th√°ng</label>
</div>

<div class="border p-2 rounded mb-3 text-sm">
<b>üîî Th√¥ng b√°o</b><br>
<label><input type="checkbox" id="n1d"> Tr∆∞·ªõc 1 ng√†y</label><br>
<label><input type="checkbox" id="n1h"> Tr∆∞·ªõc 1 gi·ªù</label><br>
<label><input type="checkbox" id="nStart"> Khi b·∫Øt ƒë·∫ßu</label><br>
<label><input type="checkbox" id="nHalf"> Khi tr√¥i qua 50%</label><br>
<label><input type="checkbox" id="nEnd1d"> Tr∆∞·ªõc khi k·∫øt th√∫c 1 ng√†y</label><br>
<label><input type="checkbox" id="nEnd1h"> Tr∆∞·ªõc khi k·∫øt th√∫c 1 gi·ªù</label><br>
<label><input type="checkbox" id="nEnd"> Khi ƒë√£ k·∫øt th√∫c</label>
</div>

<div class="flex justify-end gap-3">
<button onclick="closeModal()">Hu·ª∑</button>
<button id="saveBtn" class="bg-blue-600 text-white px-4 py-2 rounded" onclick="saveTask()">L∆∞u</button>
</div>
</div>
</div>

<script>
/* ===== DATE UTILS ===== */
const pad=n=>String(n).padStart(2,'0');
const toYMD=d=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;

/* ===== ROLE COLOR ===== */
const ROLE_COLOR={
  GVDL:'#2563eb',GVCN:'#16a34a',TTCM:'#7c3aed',
  DANG:'#dc2626',DOAN:'#f97316',DOI:'#06b6d4',KHAC:'#6b7280'
};

/* ===== STATE ===== */
let tasks=JSON.parse(localStorage.getItem('tasks')||'[]');
let viewDate=new Date();
let selectedDate=new Date();
let editingTaskId=null;

/* ===== TAB ===== */
function showTab(t){
  document.getElementById('tab-month').classList.toggle('hidden',t!=='month');
  document.getElementById('tab-day').classList.toggle('hidden',t!=='day');
  if(t==='day') renderDay();
}

/* ===== MONTH ===== */
function changeMonth(step){viewDate.setMonth(viewDate.getMonth()+step);renderMonth();}
function renderMonth(){
  monthGrid.innerHTML='';
  const y=viewDate.getFullYear(),m=viewDate.getMonth();
  monthTitle.innerText=`Th√°ng ${m+1}/${y}`;

  const firstDay=(new Date(y,m,1).getDay()+6)%7;
  const start=new Date(y,m,1-firstDay);

  for(let i=0;i<42;i++){
    const d=new Date(start);d.setDate(start.getDate()+i);
    const ymd=toYMD(d);
    const cell=document.createElement('div');
    cell.className='border rounded p-1 text-xs min-h-[60px]';
    if(d.getMonth()!==m) cell.classList.add('other-month');
    if(ymd===toYMD(new Date())) cell.classList.add('today');
    cell.innerHTML=`<div>${d.getDate()}</div>`;
    tasks.filter(t=>t.startDate<=ymd&&t.endDate>=ymd).forEach(t=>{
      const dot=document.createElement('span');
      dot.className='dot';
      dot.style.background=ROLE_COLOR[t.role]||'#6b7280';
      cell.appendChild(dot);
    });
    cell.onclick=()=>{selectedDate=d;showTab('day')};
    monthGrid.appendChild(cell);
  }
}

/* ===== STATUS ===== */
function getStatus(t){
  const now=new Date();
  const s=new Date(`${t.startDate}T${t.startTime}`);
  const e=new Date(`${t.endDate}T${t.endTime}`);
  if(now<s-2*864e5) return ['Ch∆∞a b·∫Øt ƒë·∫ßu','#6b7280'];
  if(now<s) return ['S·∫Øp b·∫Øt ƒë·∫ßu','#f59e0b'];
  if(now>=s&&now<=e-864e5) return ['ƒêang di·ªÖn ra','#2563eb'];
  if(now>e-864e5&&now<=e) return ['S·∫Øp k·∫øt th√∫c','#dc2626'];
  return ['K·∫øt th√∫c','#374151'];
}

/* ===== DAY ===== */
function renderDay(){
  dayTitle.innerText=selectedDate.toLocaleDateString('vi-VN');
  dayTasks.innerHTML='';
  const ymd=toYMD(selectedDate);
  tasks.filter(t=>t.startDate<=ymd&&t.endDate>=ymd).forEach(t=>{
    const [text,color]=getStatus(t);
    dayTasks.innerHTML+=`
      <div class="border p-2 rounded">
        <b style="color:${ROLE_COLOR[t.role]}">${t.title}</b>
        <span class="status ml-2" style="background:${color}">${text}</span><br>
        ${t.startDate} ${t.startTime} ‚Üí ${t.endDate} ${t.endTime}
        <div class="mt-1 text-right">
          <button onclick="editTask(${t.id})">‚úèÔ∏è</button>
          <button onclick="deleteTask(${t.id})">üóëÔ∏è</button>
        </div>
      </div>`;
  });
}

/* ===== EDIT / DELETE ===== */
function editTask(id){
  const t=tasks.find(x=>x.id===id);if(!t)return;
  editingTaskId=id;modalTitle.innerText='‚úèÔ∏è Ch·ªânh s·ª≠a c√¥ng vi·ªác';saveBtn.innerText='C·∫≠p nh·∫≠t';
  modalBg.style.display='flex';
  mTitle.value=t.title;mRole.value=t.role;mDetail.value=t.detail;
  mStartDate.value=t.startDate;mStartTime.value=t.startTime;
  mEndDate.value=t.endDate;mEndTime.value=t.endTime;
  document.querySelector(`input[name="mode"][value="${t.mode}"]`).checked=true;
  document.querySelector(`input[name="repeat"][value="${t.repeat}"]`).checked=true;
  n1d.checked=t.notify.n1d;n1h.checked=t.notify.n1h;nStart.checked=t.notify.nStart;
  nHalf.checked=t.notify.nHalf;nEnd1d.checked=t.notify.nEnd1d;
  nEnd1h.checked=t.notify.nEnd1h;nEnd.checked=t.notify.nEnd;
}
function deleteTask(id){
  if(!confirm('Xo√° c√¥ng vi·ªác n√†y?'))return;
  tasks=tasks.filter(t=>t.id!==id);
  localStorage.setItem('tasks',JSON.stringify(tasks));
  renderMonth();renderDay();
}

/* ===== MODAL ACTIONS ===== */
function openModal(){
  editingTaskId=null;modalTitle.innerText='‚ûï Th√™m c√¥ng vi·ªác';saveBtn.innerText='L∆∞u';
  modalBg.style.display='flex';
  const d=toYMD(selectedDate);
  mStartDate.value=d;mEndDate.value=d;
  const now=new Date();
  const h=pad(now.getHours());
  mStartTime.value=`${h}:00`;
  mEndTime.value=`${pad((now.getHours()+1)%24)}:00`;
}
function closeModal(){modalBg.style.display='none';}
function saveTask(){
  const mode=document.querySelector('input[name="mode"]:checked').value;
  const repeat=document.querySelector('input[name="repeat"]:checked').value;
  if(editingTaskId){
    const i=tasks.findIndex(t=>t.id===editingTaskId);
    if(i>-1){
      tasks[i]={...tasks[i],
        title:mTitle.value,role:mRole.value,detail:mDetail.value,
        startDate:mStartDate.value,endDate:mEndDate.value,
        startTime:mStartTime.value,endTime:mEndTime.value,
        mode,repeat,
        notify:{n1d:n1d.checked,n1h:n1h.checked,nStart:nStart.checked,nHalf:nHalf.checked,nEnd1d:nEnd1d.checked,nEnd1h:nEnd1h.checked,nEnd:nEnd.checked}
      };
    }
  }else{
    tasks.push({
      id:Date.now(),title:mTitle.value,role:mRole.value,detail:mDetail.value,
      startDate:mStartDate.value,endDate:mEndDate.value,
      startTime:mStartTime.value,endTime:mEndTime.value,
      mode,repeat,
      notify:{n1d:n1d.checked,n1h:n1h.checked,nStart:nStart.checked,nHalf:nHalf.checked,nEnd1d:nEnd1d.checked,nEnd1h:nEnd1h.checked,nEnd:nEnd.checked}
    });
  }
  localStorage.setItem('tasks',JSON.stringify(tasks));
  closeModal();renderMonth();renderDay();
}

/* ===== INIT ===== */
renderMonth();
</script>

</body>
</html>
