<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trá»£ lÃ½ GiÃ¡o viÃªn</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
.today{background:#dbeafe}
.other-month{color:#9ca3af}
.dot{width:6px;height:6px;border-radius:50%;display:inline-block;margin-right:2px}
.status{font-size:12px;padding:2px 6px;border-radius:6px;display:inline-block}
.bottom-bar{position:fixed;bottom:0;left:0;right:0;height:64px;background:#fff;border-top:1px solid #e5e7eb;display:flex;justify-content:space-around;align-items:center;z-index:1000}
.center-plus{position:fixed;bottom:32px;left:50%;transform:translateX(-50%);width:64px;height:64px;border-radius:50%;background:#2563eb;color:#fff;font-size:34px;display:flex;align-items:center;justify-content:center;z-index:1100;box-shadow:0 8px 20px rgba(0,0,0,.3)}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:2000}
.modal{background:#fff;width:92%;max-width:440px;border-radius:16px;padding:16px;max-height:90vh;overflow:auto}
</style>
</head>

<body class="bg-gray-100 pb-20">

<div class="max-w-md mx-auto bg-white min-h-screen">
<header class="p-4 text-center font-bold text-xl border-b">ğŸ“˜ Trá»£ lÃ½ GiÃ¡o viÃªn</header>

<main class="p-3">
<section id="tab-month">
  <div class="flex justify-between items-center mb-2">
    <button onclick="changeMonth(-1)">â—€</button>
    <h2 id="monthTitle" class="font-semibold"></h2>
    <button onclick="changeMonth(1)">â–¶</button>
  </div>
  <div class="grid grid-cols-7 text-center text-xs font-semibold mb-1">
    <div>CN</div><div>T2</div><div>T3</div><div>T4</div><div>T5</div><div>T6</div><div>T7</div>
  </div>
  <div id="monthGrid" class="grid grid-cols-7 gap-1"></div>
</section>

<section id="tab-day" class="hidden">
  <h2 id="dayTitle" class="font-semibold mb-2"></h2>
  <div id="dayTasks" class="space-y-2 text-sm"></div>
</section>

<section id="tab-report" class="hidden"><p class="text-sm text-gray-500">ğŸ“Š BÃ¡o cÃ¡o (sáº½ lÃ m sau)</p></section>
<section id="tab-settings" class="hidden"><p class="text-sm text-gray-500">âš™ï¸ CÃ i Ä‘áº·t (sáº½ lÃ m sau)</p></section>
</main>
</div>

<button class="center-plus" onclick="openModal()">ï¼‹</button>

<div class="bottom-bar">
  <button onclick="showTab('month')">ğŸ“…<br>ThÃ¡ng</button>
  <button onclick="showTab('day')">â°<br>NgÃ y</button>
  <div style="width:64px"></div>
  <button onclick="showTab('report')">ğŸ“Š<br>BÃ¡o cÃ¡o</button>
  <button onclick="showTab('settings')">âš™ï¸<br>CÃ i Ä‘áº·t</button>
</div>

<!-- MODAL -->
<div id="modalBg" class="modal-bg">
<div class="modal">
<h3 class="font-semibold mb-2">â• CÃ´ng viá»‡c</h3>
<input id="mTitle" class="w-full border p-2 rounded mb-2" placeholder="TÃªn cÃ´ng viá»‡c">
<select id="mRole" class="w-full border p-2 rounded mb-2">
<option value="GVDL">GVDL</option><option value="GVCN">GVCN</option>
<option value="TTCM">TTCM</option><option value="DANG">Äáº£ng viÃªn</option>
<option value="DOAN">ÄoÃ n viÃªn</option><option value="DOI">Há»— trá»£ Äá»™i</option>
<option value="KHAC">KhÃ¡c</option>
</select>
<label>Báº¯t Ä‘áº§u</label>
<input id="mStart" type="datetime-local" class="w-full border p-2 rounded mb-2" onchange="mEnd.value=this.value">
<label>Káº¿t thÃºc</label>
<input id="mEnd" type="datetime-local" class="w-full border p-2 rounded mb-2">
<div class="flex justify-end gap-2">
<button onclick="closeModal()">Huá»·</button>
<button class="bg-blue-600 text-white px-4 py-2 rounded" onclick="saveTask()">LÆ°u</button>
</div>
</div>
</div>

<script>
const ROLE_COLOR={GVDL:'#2563eb',GVCN:'#16a34a',TTCM:'#7c3aed',DANG:'#dc2626',DOAN:'#f97316',DOI:'#06b6d4',KHAC:'#6b7280'};
let tasks=JSON.parse(localStorage.getItem('tasks')||'[]');
let viewDate=new Date(), selectedDate=new Date(), editId=null;

function showTab(t){
['month','day','report','settings'].forEach(x=>document.getElementById('tab-'+x).classList.add('hidden'));
document.getElementById('tab-'+t).classList.remove('hidden');
if(t==='day') renderDay();
}

function changeMonth(s){viewDate.setMonth(viewDate.getMonth()+s);renderMonth();}

function renderMonth(){
const g=document.getElementById('monthGrid');g.innerHTML='';
const y=viewDate.getFullYear(),m=viewDate.getMonth();
monthTitle.innerText=`ThÃ¡ng ${m+1}/${y}`;
const first=new Date(y,m,1).getDay(), start=new Date(y,m,1-first);
for(let i=0;i<42;i++){
const d=new Date(start);d.setDate(start.getDate()+i);
const cell=document.createElement('div');
cell.className='border rounded p-1 text-xs min-h-[60px]';
if(d.getMonth()!==m) cell.classList.add('other-month');
if(d.toDateString()===new Date().toDateString()) cell.classList.add('today');
tasks.filter(t=>new Date(t.start)<=d && new Date(t.end)>=d).forEach(t=>{
const dot=document.createElement('span');
dot.className='dot';dot.style.background=ROLE_COLOR[t.role];
cell.appendChild(dot);
});
cell.innerHTML=`<div>${d.getDate()}</div>`+cell.innerHTML;
cell.onclick=()=>{selectedDate=d;showTab('day')};
g.appendChild(cell);
}
}

function statusText(t){
const now=new Date(), s=new Date(t.start), e=new Date(t.end);
const total=e-s, passed=now-s;
if(now<new Date(s-2*864e5)) return 'ChÆ°a báº¯t Ä‘áº§u';
if(now<s && (s-now)<=864e5) return 'Sáº¯p báº¯t Ä‘áº§u';
if(now>=s && passed<total/3) return 'ÄÃ£ báº¯t Ä‘áº§u';
if(passed>=total/3 && passed<total*2/3) return 'Äang tiáº¿n hÃ nh';
if(e-now<=864e5 && e-now>3600000) return 'Sáº¯p káº¿t thÃºc';
if(e-now<=3600000 && e>now) return 'Gáº§n háº¿t háº¡n';
if(now>=e) return 'Káº¿t thÃºc';
return '';
}

function renderDay(){
dayTitle.innerText='ğŸ“… '+selectedDate.toLocaleDateString('vi-VN');
const list=document.getElementById('dayTasks');list.innerHTML='';
tasks.filter(t=>new Date(t.start)<=selectedDate && new Date(t.end)>=selectedDate).forEach(t=>{
list.innerHTML+=`
<div class="border p-2 rounded">
<b style="color:${ROLE_COLOR[t.role]}">${t.title}</b>
<span class="status bg-gray-200 ml-2">${statusText(t)}</span><br>
${fmt(t.start)} â†’ ${fmt(t.end)}<br>
<button onclick="editTask(${t.id})">âœï¸</button>
<button onclick="deleteTask(${t.id})">ğŸ—‘ï¸</button>
</div>`;
});
}

function openModal(){
modalBg.style.display='flex';
editId=null;
mStart.value=selectedDate.toISOString().slice(0,10)+'T07:00';
mEnd.value=mStart.value;
}
function closeModal(){modalBg.style.display='none'}

function saveTask(){
const obj={id:editId||Date.now(),title:mTitle.value,role:mRole.value,start:mStart.value,end:mEnd.value};
tasks=editId?tasks.map(t=>t.id===editId?obj:t):[...tasks,obj];
localStorage.setItem('tasks',JSON.stringify(tasks));
closeModal();renderMonth();
}

function editTask(id){
const t=tasks.find(x=>x.id===id);
editId=id;
mTitle.value=t.title;mRole.value=t.role;mStart.value=t.start;mEnd.value=t.end;
modalBg.style.display='flex';
}

function deleteTask(id){
if(confirm('XÃ³a cÃ´ng viá»‡c?')){
tasks=tasks.filter(t=>t.id!==id);
localStorage.setItem('tasks',JSON.stringify(tasks));
renderMonth();renderDay();
}
}

function fmt(v){
const d=new Date(v);
return d.toLocaleDateString('vi-VN')+' - '+d.toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'});
}

renderMonth();
</script>

</body>
</html>
